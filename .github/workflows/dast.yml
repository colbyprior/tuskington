name: DAST

on:
  push:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      -
        name: Run server
        run: docker-compose up -d
      -
        name: Wait for server
        run: sleep 10
      -
        name: Get IP
        run: IP=$(ifconfig | grep "^br" -A1 | grep inet | sed 's/.*inet //' | sed 's/\s*netmask.*//')
      -
        name: test
        run: echo "$IP"
      -
        name: Run Dastardly Action Step
        uses: PortSwigger/dastardly-github-action@main
        with:
          target-url: "http://$IP:5000"

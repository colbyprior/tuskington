name: DAST

on:
  push:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      -
        name: Run server
        run: docker-compose up -d
      -
        name: Wait for server
        run: sleep 10
      -
        name: GetIP
        run: |
          IP=$(ifconfig | grep "^br" -A1 | grep inet | sed 's/.*inet //' | sed 's/\s*netmask.*//')
          echo "$IP"
          echo "IP=$IP" >> $GITHUB_OUTPUT
      -
        name: test
        run: echo "[${{steps.GetIP.outputs.IP}}]"
      -
        name: Run Dastardly Action Step
        uses: PortSwigger/dastardly-github-action@main
        with:
          target-url: "http://[${{steps.GetIP.outputs.IP}}]:5000"
